flowchart TB
    %% Rust Core Architecture
    subgraph RustCore["Rust Core"]
        subgraph OSCLayer["OSC Layer"]
            OSCServer["Server Socket"]
            IncomingHandler["Message Handler"]
            ServerValidator["Message Validator"]
            StateUpdater["State Updater"]
            ErrorHandler["Error Handler"]
            OSCClient["Client Socket"]
            RetryManager["Retry Manager"]
            MessageQueue["Message Queue"]
            Protocol["Protocol Handler"]
            
            OSCServer --> IncomingHandler
            IncomingHandler --> ServerValidator
            ServerValidator --> Protocol
            Protocol --> StateUpdater
            OSCClient --> RetryManager
            RetryManager --> MessageQueue
            MessageQueue --> Protocol
        end

        subgraph NativeBridge["Native Bridge"]
            FFILayer["FFI Interface"]
            DataMarshalling["Data Marshalling"]
            ErrorPropagation["Error Propagation"]
            CallbackRegistry["Callback Registry"]
            
            FFILayer --> DataMarshalling
            DataMarshalling --> ErrorPropagation
            FFILayer --> CallbackRegistry
        end

        subgraph StateManagement["State Management"]
            StateStore["State Store"]
            StateSync["State Sync"]
            GroupState["Group State"]
            FormationState["Formation State"]
            
            StateStore --> StateSync
            StateStore --> GroupState
            GroupState --> FormationState
        end

        subgraph AnimationEngine["Animation Engine"]
            GroupManager["Group Manager"]
            AnimModels["Animation Models"]
            InterpolationSystem["Interpolation"]
            CycleManager["Cycle Manager"]
            Timeline["Timeline"]
            
            GroupManager --> AnimModels
            AnimModels --> InterpolationSystem
            InterpolationSystem --> CycleManager
            CycleManager --> Timeline
        end

        %% Inter-module Communication
        Protocol --> StateManagement
        StateManagement --> AnimationEngine
        AnimationEngine --> NativeBridge
        StateManagement --> NativeBridge
        StateManagement --> OSCClient
        AnimationEngine --> OSCClient
    end

    %% External Connections
    Holophonix["Holophonix"] --> OSCServer
    OSCClient --> Holophonix
    ElectronMain["Electron Main"] --> NativeBridge

    %% Control Apps
    TouchOSC["TouchOSC"] --> OSCServer
    MaxMSP["Max/MSP"] --> OSCServer
    PureData["Pure Data"] --> OSCServer

    %% Styling
    classDef default fill:#2C3E50,stroke:#41B883,color:#fff
    classDef external fill:#1E1E1E,stroke:#41B883,color:#fff
    
    class Holophonix,ElectronMain,TouchOSC,MaxMSP,PureData external
