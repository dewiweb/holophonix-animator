%%{init: {
  'theme': 'dark',
  'themeVariables': {
    'fontSize': '16px',
    'fontFamily': 'arial',
    'lineWidth': '2px',
    'arrowMarkerAbsolute': true,
    'darkMode': true,
    'primaryColor': '#fff',
    'primaryTextColor': '#fff',
    'primaryBorderColor': '#fff',
    'lineColor': '#f5f5f5',
    'textColor': '#f5f5f5'
  },
  'flowchart': {
    'nodeSpacing': 50,
    'rankSpacing': 100,
    'curve': 'basis'
  }
} }%%
graph LR
    %% External Systems
    subgraph EXT["External Systems"]
        direction TB
        HD["Holophonix Device<br/>(OSC Protocol)"]
    end

    %% Animation Service
    subgraph AS["Animation Service<br/>(High Performance)"]
        direction TB
        AC["Animation Core<br/>(Rust/C++)"]
        
        subgraph CM["Computation Modules"]
            direction LR
            PC["Path Calculator<br/>(Trajectories)"]
            IE["Interpolation Engine<br/>(Smooth Transitions)"]
            TC["Timing Controller<br/>(Sync & Scheduling)"]
        end
        
        SAPI["Service API<br/>(WebSocket/gRPC)"]
        
        %% Internal Animation Service connections
        PC --> AC
        IE --> AC
        TC --> AC
        AC --> SAPI
    end

    %% Main Process
    subgraph MP["Main Process (Electron)"]
        direction TB
        MAIN["Main Process<br/>(index.ts)"]
        
        subgraph CS["Core Services"]
            direction LR
            AB["Animation Bridge<br/>(Service Client)"]
            OSC["OSC Manager<br/>(osc.ts)"]
            SET["Settings Manager<br/>(settings.ts)"]
        end
        
        IPC["IPC Main Handlers"]
        
        %% Internal Main Process connections
        MAIN --> AB & OSC & SET & IPC
        AB --> OSC & IPC
        OSC --> IPC
        SET --> IPC
    end

    %% Renderer Process
    subgraph RP["Renderer Process (Frontend)"]
        direction TB
        PB["Preload Bridge<br/>(preload.ts)"]
        RA["React Application<br/>(renderer.tsx)"]
        
        subgraph CC["Core Components"]
            direction LR
            TL["Timeline<br/>Component"]
            WS["3D Workspace<br/>(Three.js)"]
            CP["Control Panel"]
        end
        
        subgraph SM["State Management"]
            AS_["Application State"]
        end
        
        %% Internal Renderer Process connections
        PB --> RA
        RA --> AS_
        AS_ --> TL & WS & CP
    end

    %% Cross-component connections
    HD <--> |"OSC Messages"| OSC
    SAPI <--> |"High-speed data"| AB
    IPC <--> |"IPC Channel"| PB
    TL --> |"Commands"| PB
    
    %% Styling
    classDef default fill:#2d2d2d,stroke:#f5f5f5,stroke-width:1px,color:#f5f5f5
    classDef process fill:#2d2d2d,stroke:#ff4081,stroke-width:3px,color:#f5f5f5
    classDef component fill:#2d2d2d,stroke:#64b5f6,stroke-width:3px,color:#f5f5f5
    classDef external fill:#2d2d2d,stroke:#81c784,stroke-width:3px,color:#f5f5f5
    classDef core fill:#2d2d2d,stroke:#ba68c8,stroke-width:4px,color:#f5f5f5
    classDef compute fill:#2d2d2d,stroke:#ffb74d,stroke-width:3px,color:#f5f5f5
    
    class MAIN,OSC,SET process
    class TL,WS,CP component
    class HD external
    class AC,PC,IE,TC compute
    class SAPI,AB core
    
    %% Subgraph styling
    style EXT fill:#1a1a1a,stroke:#f5f5f5,stroke-width:2px,color:#f5f5f5
    style AS fill:#262626,stroke:#f5f5f5,stroke-width:2px,color:#f5f5f5
    style MP fill:#1f1f1f,stroke:#f5f5f5,stroke-width:2px,color:#f5f5f5
    style RP fill:#262626,stroke:#f5f5f5,stroke-width:2px,color:#f5f5f5
